{"version":3,"sources":["handleFactory.js"],"names":["catchAsync","require","AppError","exports","req","res","next","regeneratorRuntime","async","_context","prev","awrap","findByIdAndDelete","params","id","sent","abrupt","status","json","data","stop","updateOne","Model","doc","findByIdAndUpdate","body","new","runValidators","createOne","_context3","create","getOne","popOptions","query","_context4","findById","populate","tourId","filter","tour","features","APIFeatures","find","sort","limitFields","paginate","results","length"],"mappings":"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","file":"handleFactory.min.js","sourcesContent":["const catchAsync = require('./../utils/catchAsync');\nconst AppError = require('./../utils/appError');\nconst APIFeatures = require('./../utils/apiFeatures');\n\nexports.deleteOne = Model =>\n  catchAsync(async (req, res, next) => {\n    const doc = await Model.findByIdAndDelete(req.params.id);\n\n    if (!doc) {\n      return next(new AppError('No document found with that ID', 404));\n    }\n\n    res.status(204).json({\n      status: 'success',\n      data: null\n    });\n  });\n\nexports.updateOne = Model =>\n  catchAsync(async (req, res, next) => {\n    const doc = await Model.findByIdAndUpdate(req.params.id, req.body, {\n      new: true,\n      runValidators: true\n    });\n\n    if (!doc) {\n      return next(new AppError('No document found with that ID', 404));\n    }\n\n    res.status(200).json({\n      status: 'success',\n      data: {\n        data: doc\n      }\n    });\n  });\n\nexports.createOne = Model =>\n  catchAsync(async (req, res, next) => {\n    const doc = await Model.create(req.body);\n\n    res.status(201).json({\n      status: 'success',\n      data: {\n        data: doc\n      }\n    });\n  });\n\nexports.getOne = (Model, popOptions) =>\n  catchAsync(async (req, res, next) => {\n    let query = Model.findById(req.params.id);\n    if (popOptions) query = query.populate(popOptions);\n    const doc = await query;\n\n    if (!doc) {\n      return next(new AppError('No document found with that ID', 404));\n    }\n\n    res.status(200).json({\n      status: 'success',\n      data: {\n        data: doc\n      }\n    });\n  });\n\nexports.getAll = Model =>\n  catchAsync(async (req, res, next) => {\n    // To allow for nested GET reviews on tour (hack)\n    let filter = {};\n    if (req.params.tourId) filter = { tour: req.params.tourId };\n\n    const features = new APIFeatures(Model.find(filter), req.query)\n      .filter()\n      .sort()\n      .limitFields()\n      .paginate();\n    // const doc = await features.query.explain();\n    const doc = await features.query;\n\n    // SEND RESPONSE\n    res.status(200).json({\n      status: 'success',\n      results: doc.length,\n      data: {\n        data: doc\n      }\n    });\n  });\n"]}